-- LocalScript in StarterPlayerScripts
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- GUI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ExplorerGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 160, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.Text = "Open World Explorer"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18
toggleButton.Parent = screenGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 500, 0, 400)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 2
mainFrame.Visible = false
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local titleBar = Instance.new("TextLabel")
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
titleBar.Text = "World Explorer"
titleBar.Font = Enum.Font.SourceSansBold
titleBar.TextSize = 20
titleBar.TextColor3 = Color3.new(1, 1, 1)
titleBar.Parent = mainFrame

local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -35, 0, 5)
closeButton.Text = "X"
closeButton.BackgroundColor3 = Color3.fromRGB(100, 30, 30)
closeButton.TextColor3 = Color3.new(1, 1, 1)
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 16
closeButton.Parent = mainFrame

local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -20, 1, -60)
scrollFrame.Position = UDim2.new(0, 10, 0, 50)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 8
scrollFrame.Parent = mainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 4)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = scrollFrame

-- Updates scroll height
local function updateCanvas()
	scrollFrame.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvas)

-- Generates buttons for all objects in game
local function listAllObjects()
	scrollFrame:ClearAllChildren()
	UIListLayout.Parent = scrollFrame -- reattach after clear

	local objects = game:GetDescendants()
	table.sort(objects, function(a, b)
		return a:GetFullName() < b:GetFullName()
	end)

	for _, obj in ipairs(objects) do
		local name = obj:GetFullName()
		local button = Instance.new("TextButton")
		button.Size = UDim2.new(1, -10, 0, 28)
		button.Text = name
		button.TextColor3 = Color3.new(1, 1, 1)
		button.Font = Enum.Font.Code
		button.TextSize = 14
		button.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
		button.Parent = scrollFrame

		button.MouseButton1Click:Connect(function()
			pcall(function()
				local clone = obj:Clone()
				clone.Name = obj.Name .. "_Copy"
				clone.Parent = workspace
				if clone:IsA("Model") and clone:FindFirstChild("PrimaryPart") then
					clone:SetPrimaryPartCFrame(player.Character.HumanoidRootPart.CFrame + Vector3.new(5, 0, 0))
				elseif clone:IsA("BasePart") then
					clone.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(5, 0, 0)
				end
			end)
		end)
	end
end

-- Toggle GUI
toggleButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
	if mainFrame.Visible then
		toggleButton.Text = "Close World Explorer"
		listAllObjects()
	else
		toggleButton.Text = "Open World Explorer"
	end
end)

closeButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = false
	toggleButton.Text = "Open World Explorer"
end)
